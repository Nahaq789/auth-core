# 認証基盤要件定義書

## 1. プロジェクト概要

- AWS Lambda + API Gateway 環境
- 認証には Cognito を使用

## 2. 認証アーキテクチャ

- クライアント ⇔ バックエンド(Lambda) ⇔ Cognito
- SRP (Secure Remote Password) プロトコルの採用
- DynamoDB でのユーザー情報管理

## 3. 主要機能

### サインアップ

- メールアドレス + パスワードでの登録
- メールアドレスの重複チェック
- メールによる確認コード認証（VerifyCode）
- DynamoDB へのユーザー情報保存

### サインイン

- SRP プロトコルによる安全な認証
- ID トークンとリフレッシュトークンの発行

### サインアウト

- リフレッシュトークンを無効化する

### トークン管理

- ID トークン：API Gateway 認証用（短期）
- リフレッシュトークン：トークン更新用（長期）
- トークンリフレッシュ機能

## 4. セキュリティ機能（優先度順）

### A) レート制限

- API Gateway Usage Plan 活用

### B) トークン有効期限管理

- 適切な有効期限設定
- リフレッシュフローの実装

不正利用の検知と防止

## 5. 認証フロー詳細

### 初期認証

1. クライアント：ユーザー名と SRP_A 送信
2. バックエンド：InitiateAuth
3. Cognito：チャレンジレスポンス
4. クライアント：チャレンジ応答
5. 認証成功時：ID トークン、リフレッシュトークン発行

### API 認証

- API Gateway の Cognito オーソライザーで ID トークンを検証
- 有効期限切れ時はリフレッシュトークンで更新
